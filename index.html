<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Monster Hunter Events Today</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #f6f4e4;
                color: #222;
                padding: 20px;
                margin: auto;
                text-align: center;
                overflow-x: hidden;
            }

            .logo {
                width: 300px;
                margin-bottom: 30px;
            }

            .heading {
                font-size: 60px;
                font-style: italic;
                font-weight: 700;
            }

            .date {
                font-size: 24px;
                font-weight: 600;
            }

            .events-section {
                margin: 20px 0;
            }

            .card {
                max-width: 600px;
                margin: 0 auto 20px;
                padding: 20px;
                border-radius: 10px;
                background: #222;
                color: #f6f4e4;
            }

            .card-heading {
                font-size: 24px;
                font-weight: 700;
            }

            .card-content {
                font-size: 18px;
                margin-top: 15px;
            }

            .footer {
                margin-top: 30px;
                font-size: 16px;
            }

            a {
                color: #4a90e2;
                text-decoration: none;
            }
        </style>
    </head>

    <body>
        <img
            src="docs/assets/monster-hunter-now-logo.png"
            alt="Monster Hunter Now Logo"
            class="logo"
        />

        <div class="heading">Monster Hunter Events Today</div>

        <div class="date" id="tag_display_date"></div>

        <div class="events-section" id="tag_display_events"></div>

        <script type="text/javascript">
            //... (Your script remains unchanged)
        </script>

        <div class="footer">
            <p>
                Made with ‚ù§ by
                <a
                    href="https://github.com/seriouslysean"
                    target="_blank"
                    >Sean</a
                >
            </p>
            <p><a href="/dist/events.ics">Subscribe to the ICS file</a></p>
        </div>

        <script type="text/javascript">
            // Function to append data to the events list
            const appendToEventsList = (data) => {
                const eventsList = [];
                data.events.forEach((event) => {
                    event.dates.every((date) => {
                        const startDate = new Date(date.start);
                        const endDate = new Date(date.end);
                        const currentDate = new Date();

                        if (
                            startDate <= currentDate &&
                            endDate >= currentDate
                        ) {
                            eventsList.push({
                                name: event.summary,
                                desc: event.description,
                                startTime: startDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                                endTime: endDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                            });
                            return false;
                        }
                        return true;
                    });
                });
                return eventsList;
            };

            // Function to fetch JSON data
            const fetchEventData = async () => {
                try {
                    const response = await fetch('dist/events.json');
                    if (!response.ok) {
                        throw new Error(
                            'Unable to fetch the event data. Please try again later.',
                        );
                    }
                    const eventData = await response.json();
                    return appendToEventsList(eventData);
                } catch (error) {
                    console.error(`Error: ${error.message}`);
                }
            };

            // Initialization function
            const init = async () => {
                const eventsTodayList = await fetchEventData();
                const tagDisplay =
                    document.getElementById('tag_display_events');
                const userLocalDate = new Date();

                document.getElementById('tag_display_date').textContent = `${
                    userLocalDate.getMonth() + 1
                }/${userLocalDate.getDate()}/${userLocalDate.getFullYear()}`;

                if (!eventsTodayList || !eventsTodayList.length) {
                    tagDisplay.innerHTML += `<div class="card-heading">
                        No events scheduled for today!
                    </div>`;
                } else {
                    eventsTodayList.forEach((event) => {
                        tagDisplay.innerHTML += `<div class="card">
                            <div class="card-heading">${event.name} (${event.startTime} - ${event.endTime})</div>
                            <div class="card-content">${event.desc}</div>
                        </div>`;
                    });
                }
            };

            // Ensure the document is fully loaded before initializing
            window.addEventListener('load', () => {
                init();
            });
        </script>
    </body>
</html>
